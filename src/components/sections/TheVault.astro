---
import { getCollection } from 'astro:content';
import Vault from '../svelte/Vault.svelte';

// 1. Pobranie danych kart (Frontmatter)
const projectsData = await getCollection('projects');

// 2. Pobranie opisów (Body)
const detailsData = await getCollection('details');

// 3. DATA MERGE (Synteza)
// Łączymy projekt z jego opisem na podstawie ID (nazwy pliku)
const mergedProjects = projectsData.map((project) => {
  // Szukamy pasującego pliku w folderze details
  const detail = detailsData.find((d) => d.id === project.id);
  
  return {
    ...project,
    // Wstrzykujemy treść z pliku detali. Jeśli brak pliku - pusty string.
    body: detail ? detail.body : "" 
  };
});

// 4. Sortowanie
const sortedProjects = mergedProjects.sort((a, b) => a.data.order - b.data.order);
---

<section id="projects" class="relative py-32 bg-void overflow-hidden">
  
  <div class="absolute inset-0 bg-cyber-grid opacity-20 pointer-events-none"></div>
  
  <div class="absolute top-0 left-0 w-full h-32 bg-linear-to-b from-void to-transparent z-10"></div>

  <div class="container mx-auto px-6 relative z-20">
    
    <div class="mb-24 border-l-4 border-lime pl-6">
      <h2 class="text-5xl md:text-7xl font-display font-bold text-white mb-4 uppercase">
        The <span class="text-lime">Vault</span>.
      </h2>
      <p class="text-subtext font-mono text-sm md:text-base max-w-xl leading-relaxed">
        [ ARCHIVE_ACCESS_GRANTED ] <br />
        Wyselekcjonowane wdrożenia. Od skomplikowanej inżynierii danych po nagradzany design. Kliknij kartę, aby pobrać pełny raport.
      </p>
    </div>

    <Vault client:visible projects={sortedProjects} />

  </div>
</section>